<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Ascend – Workout Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
</head>
<body>

  <h1>Ascend</h1>
  <p>Enter a username to start tracking your workouts</p>

  <input
    type="text"
    id="username"
    placeholder="Username"
    autocomplete="off"
  />

  <br><br>

  <button id="startBtn">Start Tracking</button>

  <p id="status" style="display:none;">Loading...</p>

  <script>
    const startBtn = document.getElementById("startBtn");
    const statusText = document.getElementById("status");

    startBtn.addEventListener("click", async () => {
      const username = document.getElementById("username").value.trim();

      if (!username) {
        alert("Please enter a username");
        return;
      }

      startBtn.disabled = true;
      statusText.style.display = "block";

      try {
        const res = await fetch("/api/users", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ username })
        });

        if (!res.ok) {
          throw new Error("Failed to create or fetch user");
        }

        const data = await res.json();

        // ✅ SAVE USER ID
        localStorage.setItem("userId", data._id);

        console.log("Saved userId:", data._id);

        // ✅ GO TO ADD WORKOUT PAGE
        window.location.href = "/add.html";

      } catch (err) {
        console.error(err);
        alert("Login failed. Check console.");
        startBtn.disabled = false;
        statusText.style.display = "none";
      }
    });
  </script>

</body>
</html>
